<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Everest Korean Lesson</title>

    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f8f9fa">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=3.1">
</head>

<body>

    <header>
        <div style="position: absolute; top: 20px; right: 20px;">
            <button id="btn-login" onclick="window.openLoginModal()" class="btn-install btn-help"
                style="font-size: 0.8rem; padding: 5px 10px;">
                <i class="fas fa-user-circle"></i> Login
            </button>
            <div id="user-profile" style="display: none; align-items: center; gap: 10px;">
                <span id="user-name" style="font-weight: bold; color: var(--primary-color);">Guest</span>
                <span class="chip active" style="padding: 5px 10px; font-size: 0.8rem;">üí∞ <span
                        id="user-points">0</span></span>
            </div>
        </div>
        <h1>Everest Korean Lesson</h1>
        <p class="subtitle">AI Korean Teacher for Nepali Staff<br>(‡§®‡•á‡§™‡§æ‡§≤‡•Ä ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä‡§π‡§∞‡•Ç‡§ï‡§æ ‡§≤‡§æ‡§ó‡§ø ‡§è‡§Ü‡§à ‡§ï‡•ã‡§∞‡§ø‡§Ø‡§æ‡§≤‡•Ä ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï)</p>
    </header>

    <div id="debug-log"
        style="position:fixed; top:0; left:0; right:0; background:red; color:white; padding:10px; z-index:99999; display:none; white-space:pre-wrap;">
    </div>

    <div class="container">
        <!-- Challenge Section (Visible after Login) -->
        <div id="challenge-section" class="install-banner"
            style="display: none; background: linear-gradient(135deg, #6c5ce7, #a29bfe);">
            <h3>üî• Today's Challenge (‡§Ü‡§ú‡§ï‡•ã ‡§ö‡•Å‡§®‡•å‡§§‡•Ä)</h3>
            <p style="font-size:0.9rem; margin-bottom: 10px;">Practice today's sentences and earn 150 points!</p>
            <div id="mission-status"
                style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px; font-weight: bold;">
                Mission Ready üöÄ
            </div>
        </div>

        <!-- Install & Guide Section Removed -->

        <!-- Category Dropdown System -->
        <div class="category-wrapper">
            <div id="category-header" class="category-header" onclick="toggleCategoryMenu()">
                <div style="flex-grow:1; overflow:hidden;">
                    <span id="current-category-label" class="current-category" style="font-size:0.95rem;">All
                        Categories</span>
                </div>
                <span class="toggle-icon" style="flex-shrink:0;"><i class="fas fa-chevron-down"></i></span>
            </div>

            <div id="category-dropdown" class="category-dropdown">
                <!-- Categories injected here -->
            </div>
        </div>

        <!-- Content Grid -->
        <div id="card-container" class="card-grid">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading Data... (v4.0)
            </div>
        </div>

        <div style="text-align:center; margin-top:20px; color:#aaa; font-size:12px;">App Version 4.6</div>
        <div style="text-align:center; margin-top:10px;">
            <button
                onclick="alert('ÏãúÏä§ÌÖú Ï†ïÎ≥¥:\n' + navigator.userAgent + '\n\nÎ≥¥Ïïà Ïó∞Í≤∞: ' + window.isSecureContext + '\nÏùåÏÑ± Ïû¨ÏÉù: ' + !!window.speechSynthesis + '\nÏùåÏÑ± Ïù∏Ïãù: ' + !!window.webkitSpeechRecognition)"
                style="background:none; border:1px solid #ddd; color:#ddd; font-size:10px; padding:2px 5px; border-radius:5px;">Check
                System (Î≤ÑÏ†Ñ ÌôïÏù∏)</button>
        </div>
    </div>

    <!-- Modals -->
    <!-- iPhone Guide -->
    <div id="ios-modal" class="modal-overlay" onclick="closeModal('ios-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal('ios-modal')">&times;</span>
            <h2>iPhone Guide (‡§Ü‡§á‡§´‡•ã‡§® ‡§ó‡§æ‡§á‡§°)</h2>

            <div
                style="background:#fff3cd; color:#856404; padding:10px; border-radius:10px; margin-bottom:15px; font-size:0.9rem; border:1px solid #ffeeba;">
                <b>‚ö†Ô∏è CRITICAL (‡§Æ‡§π‡§§‡•ç‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£):</b><br>
                Do NOT use KakaoTalk browser.<br>(‡§ï‡§æ‡§ï‡§æ‡§ì‡§ü‡§ï ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§∞ ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§®‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§)<br>
                <b>Use Safari ONLY (‡§∏‡§´‡§æ‡§∞‡•Ä ‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç)</b>
            </div>

            <div class="guide-step">
                <b>1. Open Safari Browser</b>
                <span class="guide-text">Safari ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§∞‡§Æ‡§æ ‡§ú‡§æ‡§®‡•Å‡§π‡•ã‡§∏‡•ç</span>
            </div>
            <div class="guide-step">
                <b>2. Tap Share Button <i class="fas fa-share-square"></i></b>
                <span class="guide-text">‡§∏‡§æ‡§ù‡§æ (Share) ‡§¨‡§ü‡§® ‡§ü‡•ç‡§Ø‡§æ‡§™ ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</span>
            </div>
            <div class="guide-step">
                <b>3. Add to Home Screen <i class="fas fa-plus-square"></i></b>
                <span class="guide-text">'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä' (Home Screen ‡§Æ‡§æ ‡§•‡§™‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç)</span>
            </div>
            <button class="btn-install btn-android" style="width:100%;" onclick="closeModal('ios-modal')">OK, Understood
                (‡§†‡§ø‡§ï ‡§õ)</button>
        </div>
    </div>

    <!-- Sound Help -->
    <div id="sound-modal" class="modal-overlay" onclick="closeModal('sound-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal('sound-modal')">&times;</span>
            <h2>Sound Help (‡§ß‡•ç‡§µ‡§®‡§ø ‡§Æ‡§¶‡•ç‡§¶‡§§)</h2>
            <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">If you can't hear any sound (‡§Ø‡§¶‡§ø ‡§§‡§™‡§æ‡§à‡§Ç‡§≤‡•á ‡§Ü‡§µ‡§æ‡§ú
                ‡§∏‡•Å‡§®‡•ç‡§® ‡§∏‡§ï‡•ç‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§® ‡§≠‡§®‡•á):</p>

            <div class="guide-step">
                <b>[Android / Google TTS]</b>
                <span class="guide-text">1. Settings > General management</span>
                <span class="guide-text">2. Text-to-speech output</span>
                <span class="guide-text">3. Install voice data > <b>Download Korean</b></span>
                <span class="guide-text">‡§ï‡•ã‡§∞‡§ø‡§Ø‡§æ‡§≤‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</span>
            </div>

            <div class="guide-step">
                <b>[iPhone / iOS]</b>
                <span class="guide-text">Check Silent Mode switch (‡§Æ‡•å‡§® ‡§Æ‡•ã‡§° ‡§∏‡•ç‡§µ‡§ø‡§ö ‡§ú‡§æ‡§Å‡§ö ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç)</span>
            </div>
            <button class="btn-install btn-android" style="width:100%;" onclick="closeModal('sound-modal')">Close (‡§¨‡§®‡•ç‡§¶
                ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç)</button>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal-overlay" onclick="closeModal('feedback-modal')">
        <div class="modal-content feedback-content" onclick="event.stopPropagation()">
            <div id="feedback-icon" class="clap-icon">üëè</div>
            <h2 id="feedback-title">Great!</h2>
            <p id="feedback-sub" style="color:#222; margin-bottom:15px; font-size:1.2rem; font-weight:bold;"></p>
            <p id="feedback-text" style="font-size:1rem; color:#444;"></p>
            <button class="btn-install btn-android" style="width:100%; margin-top:20px;"
                onclick="closeModal('feedback-modal')">Next (Îã§Ïùå)</button>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal-overlay" onclick="closeModal('login-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal('login-modal')">&times;</span>
            <h2>Member Login</h2>
            <p id="modal-subtitle" style="color:#666; margin-bottom: 20px;">Everest Pay Point System</p>

            <!-- Toggle Buttons -->
            <!-- Toggle Buttons -->
            <div style="display:flex; gap:0; margin-bottom:25px; border-bottom:1px solid #eee;">
                <button id="tab-login" onclick="switchAuthMode('login')" class="active-tab">Login</button>
                <button id="tab-register" onclick="switchAuthMode('register')" class="inactive-tab">Register</button>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display:block; margin-bottom:5px; font-weight:bold;">Branch (ÏßÄÏ†ê)</label>
                <select id="login-branch"
                    style="width:100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background: white;">
                    <option value="">Loading branches...</option>
                </select>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display:block; margin-bottom:5px; font-weight:bold;">Name (Ïù¥Î¶Ñ)</label>
                <input type="text" id="login-name" placeholder="Enter your name"
                    style="width:100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display:block; margin-bottom:5px; font-weight:bold;">Password (ÎπÑÎ∞ÄÎ≤àÌò∏)</label>
                <input type="password" id="login-pw" placeholder="Enter password"
                    style="width:100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px;">
            </div>

            <button id="btn-submit-auth" onclick="handleAuthSubmit()" class="btn-install btn-android"
                style="width:100%; justify-content: center;">
                Login (Î°úÍ∑∏Ïù∏)
            </button>
            <p id="login-msg" style="color: red; text-align: center; margin-top: 10px; font-size: 0.9rem;"></p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

</body>

</html>
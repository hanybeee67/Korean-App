<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Everest Korean Tutor</title>

    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f8f9fa">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=3.3">
</head>

<body>

    <header>
        <h1>Everest Korean</h1>
        <p class="subtitle">AI Korean Teacher for Nepali Staff<br>(рдиреЗрдкрд╛рд▓реА рдХрд░реНрдордЪрд╛рд░реАрд╣рд░реВрдХрд╛ рд▓рд╛рдЧрд┐ рдПрдЖрдИ рдХреЛрд░рд┐рдпрд╛рд▓реА рд╢рд┐рдХреНрд╖рдХ)</p>

        <!-- Everest-Pay Widget -->
        <div id="ep-widget" class="ep-widget" onclick="openModal('profile-modal')" style="display:none;">
            <div class="ep-level" id="user-level-badge">ЁЯМ▒ Intern</div>
            <div class="ep-balance">
                <i class="fas fa-coins"></i> <span id="user-balance">0</span>
            </div>
        </div>
    </header>

    <div id="debug-log"
        style="position:fixed; top:0; left:0; right:0; background:red; color:white; padding:10px; z-index:99999; display:none; white-space:pre-wrap;">
    </div>

    <div class="container">
        <!-- Install & Guide Section -->
        <div id="install-section" class="install-banner">
            <h3>ЁЯУ▒ Install Everest App</h3>
            <p style="font-size:0.85rem; opacity:0.9;">Installation & Sound Settings Guide for Staff<br>(рдХрд░реНрдордЪрд╛рд░реАрд╣рд░реВрдХреЛ
                рд▓рд╛рдЧрд┐ рд╕реНрдерд╛рдкрдирд╛ рд░ рдзреНрд╡рдирд┐ рд╕реЗрдЯрд┐рдЩ рдЧрд╛рдЗрдб)</p>
            <div class="install-actions">
                <a href="https://drive.google.com/file/d/1jhNrD_c_0c8bwKndu_QsBQXspxTd8HaQ/view?usp=sharing"
                    target="_blank" class="btn-install btn-android">
                    <i class="fab fa-android"></i> Android APK
                </a>
                <button onclick="openModal('ios-modal')" class="btn-install btn-help">
                    <i class="fab fa-apple"></i> iPhone Guide
                </button>
                <button onclick="openModal('sound-modal')" class="btn-install btn-help"
                    style="border-color:#ffcc00; color:#ffcc00;">
                    <i class="fas fa-volume-up"></i> Sound Help
                </button>
            </div>
        </div>

        <!-- Today's Mission Section -->
        <div id="mission-section" class="mission-section" style="display:none;">
            <div class="mission-header">
                <i class="fas fa-fire" style="color:#e74c3c;"></i> Today's Mission (ьШдыКШьЭШ ып╕ьЕШ)
            </div>
            <div id="mission-container" class="card-grid">
                <!-- Mission Cards will be injected here -->
            </div>
            <hr style="border:0; border-top:1px solid rgba(0,0,0,0.1); margin:20px 0;">
        </div>

        <!-- Category Dropdown System -->
        <div class="category-wrapper">
            <div id="category-header" class="category-header" onclick="toggleCategoryMenu()">
                <div style="flex-grow:1; overflow:hidden;">
                    <span id="current-category-label" class="current-category" style="font-size:0.95rem;">All
                        Categories</span>
                </div>
                <span class="toggle-icon" style="flex-shrink:0;"><i class="fas fa-chevron-down"></i></span>
            </div>

            <div id="category-dropdown" class="category-dropdown">
                <!-- Categories injected here -->
            </div>
        </div>

        <!-- Content Grid -->
        <div id="card-container" class="card-grid">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading Data... (v4.0)
            </div>
        </div>

        <div style="text-align:center; margin-top:20px; color:#aaa; font-size:12px;">App Version 4.7 (Everest-Pay)</div>
        <div style="text-align:center; margin-top:10px;">
            <button
                onclick="alert('ьЛЬьКдэЕЬ ьаХы│┤:\n' + navigator.userAgent + '\n\nы│┤ьХИ ьЧ░ъ▓░: ' + window.isSecureContext + '\nьЭМьД▒ ьЮмьГЭ: ' + !!window.speechSynthesis + '\nьЭМьД▒ ьЭ╕ьЛЭ: ' + !!window.webkitSpeechRecognition)"
                style="background:none; border:1px solid #ddd; color:#ddd; font-size:10px; padding:2px 5px; border-radius:5px;">Check
                System (ы▓ДьаД эЩХьЭ╕)</button>
            <button onclick="location.href='?mode=admin'"
                style="background:none; border:1px solid #ddd; color:#ddd; font-size:10px; padding:2px 5px; border-radius:5px; margin-left:5px;">Admin</button>
        </div>
    </div>

    <!-- Modals -->

    <!-- Login Modal -->
    <div id="login-modal" class="modal-overlay">
        <!-- Click outside blocked by not adding onclick close logic to overlay -->
        <div class="modal-content" style="max-width:350px;">
            <h2 style="text-align:center; margin-bottom:5px;">ЁЯСЛ эЩШьШБэХйыЛИыЛд!</h2>
            <p style="text-align:center; color:#666; margin-bottom:20px;">Welcome to Everest Korean</p>

            <div class="form-group">
                <label class="form-label">ьзАьаР (Branch)</label>
                <select id="login-branch" class="form-select">
                    <option value="">ьзАьаРьЭД ьДаэГЭэХШьД╕ьЪФ (Choose Branch)</option>
                    <option value="Yeongtong">ьШБэЖ╡ (Yeongtong)</option>
                    <option value="Dongtan">ыПЩэГД (Dongtan)</option>
                    <option value="Hanam">эХШыВи (Hanam)</option>
                    <option value="Starfield">ьКдэГАэХДыУЬ (Starfield)</option>
                    <option value="Pangyo">эМРъ╡Р (Pangyo)</option>
                    <option value="Mugyo">ым┤ъ╡Р (Mugyo)</option>
                    <option value="Yeouido">ьЧмьЭШыПД (Yeouido)</option>
                    <option value="Jamsil">ьЮаьЛд (Jamsil)</option>
                    <option value="Other">ъ╖╕ ьЩ╕ (Other)</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">ьЭ┤ыжД (Name)</label>
                <input type="text" id="login-name" class="form-input" placeholder="Enter your name (ьШБьЦ┤ ьЭ┤ыжД)">
            </div>

            <button class="btn-primary" onclick="handleLogin()">Start (ьЛЬьЮСэХШъ╕░)</button>
        </div>
    </div>

    <!-- Profile/Stats Modal -->
    <div id="profile-modal" class="modal-overlay" onclick="closeModal('profile-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal('profile-modal')">&times;</span>
            <h2>My Everest Pay</h2>
            <div style="text-align:center; margin:20px 0;">
                <div style="font-size:3rem;">ЁЯМ▒</div>
                <h3 id="profile-name">Name</h3>
                <p id="profile-branch" style="color:#666;">Branch</p>
                <div style="font-size:2.5rem; color:#e67e22; font-weight:800; margin-top:10px;">
                    тВй <span id="profile-balance">0</span>
                </div>
                <p style="color:#aaa; font-size:0.9rem;">Current Points</p>
            </div>
            <div style="background:#f9f9f9; padding:15px; border-radius:15px;">
                <h4>ЁЯПЖ Level Progress</h4>
                <div style="background:#e0e0e0; height:10px; border-radius:5px; margin-top:5px; overflow:hidden;">
                    <div style="background:#2ecc71; width:20%; height:100%;"></div>
                </div>
                <p style="font-size:0.8rem; color:#666; margin-top:5px; text-align:right;">Next Level: Staff</p>
            </div>
        </div>
    </div>

    <!-- iPhone Guide -->
    <div id="ios-modal" class="modal-overlay" onclick="closeModal('ios-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal('ios-modal')">&times;</span>
            <h2>iPhone Guide (рдЖрдЗрдлреЛрди рдЧрд╛рдЗрдб)</h2>

            <div
                style="background:#fff3cd; color:#856404; padding:10px; border-radius:10px; margin-bottom:15px; font-size:0.9rem; border:1px solid #ffeeba;">
                <b>тЪая╕П CRITICAL (рдорд╣рддреНрддреНрд╡рдкреВрд░реНрдг):</b><br>
                Do NOT use KakaoTalk browser.<br>(рдХрд╛рдХрд╛рдУрдЯрдХ рдмреНрд░рд╛рдЙрдЬрд░ рдкреНрд░рдпреЛрдЧ рдирдЧрд░реНрдиреБрд╣реЛрд╕реНред)<br>
                <b>Use Safari ONLY (рд╕рдлрд╛рд░реА рдорд╛рддреНрд░ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреБрд╣реЛрд╕реН)</b>
            </div>

            <div class="guide-step">
                <b>1. Open Safari Browser</b>
                <span class="guide-text">Safari рдмреНрд░рд╛рдЙрдЬрд░рдорд╛ рдЬрд╛рдиреБрд╣реЛрд╕реН</span>
            </div>
            <div class="guide-step">
                <b>2. Tap Share Button <i class="fas fa-share-square"></i></b>
                <span class="guide-text">рд╕рд╛рдЭрд╛ (Share) рдмрдЯрди рдЯреНрдпрд╛рдк рдЧрд░реНрдиреБрд╣реЛрд╕реН</span>
            </div>
            <div class="guide-step">
                <b>3. Add to Home Screen <i class="fas fa-plus-square"></i></b>
                <span class="guide-text">'эЩИ эЩФый┤ьЧР ь╢Фъ░А' (Home Screen рдорд╛ рдердкреНрдиреБрд╣реЛрд╕реН)</span>
            </div>
            <button class="btn-install btn-android" style="width:100%;" onclick="closeModal('ios-modal')">OK, Understood
                (рдард┐рдХ рдЫ)</button>
        </div>
    </div>

    <!-- Sound Help -->
    <div id="sound-modal" class="modal-overlay" onclick="closeModal('sound-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="modal-close" onclick="closeModal('sound-modal')">&times;</span>
            <h2>Sound Help (рдзреНрд╡рдирд┐ рдорджреНрджрдд)</h2>
            <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">If you can't hear any sound (рдпрджрд┐ рддрдкрд╛рдИрдВрд▓реЗ рдЖрд╡рд╛рдЬ
                рд╕реБрдиреНрди рд╕рдХреНрдиреБрд╣реБрдиреНрди рднрдиреЗ):</p>

            <div class="guide-step">
                <b>[Android / Google TTS]</b>
                <span class="guide-text">1. Settings > General management</span>
                <span class="guide-text">2. Text-to-speech output</span>
                <span class="guide-text">3. Install voice data > <b>Download Korean</b></span>
                <span class="guide-text">рдХреЛрд░рд┐рдпрд╛рд▓реА рднрд╛рд╖рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдЧрд░реНрдиреБрд╣реЛрд╕реН</span>
            </div>

            <div class="guide-step">
                <b>[iPhone / iOS]</b>
                <span class="guide-text">Check Silent Mode switch (рдореМрди рдореЛрдб рд╕реНрд╡рд┐рдЪ рдЬрд╛рдБрдЪ рдЧрд░реНрдиреБрд╣реЛрд╕реН)</span>
            </div>
            <button class="btn-install btn-android" style="width:100%;" onclick="closeModal('sound-modal')">Close (рдмрдиреНрдж
                рдЧрд░реНрдиреБрд╣реЛрд╕реН)</button>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="modal-overlay" onclick="closeModal('feedback-modal')">
        <div class="modal-content feedback-content" onclick="event.stopPropagation()">
            <div id="feedback-icon" class="clap-icon">ЁЯСП</div>
            <h2 id="feedback-title">Great!</h2>
            <p id="feedback-sub" style="color:#222; margin-bottom:15px; font-size:1.2rem; font-weight:bold;"></p>
            <p id="feedback-text" style="font-size:1rem; color:#444;"></p>
            <button class="btn-install btn-android" style="width:100%; margin-top:20px;"
                onclick="closeModal('feedback-modal')">Next (ыЛдьЭМ)</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js?v=4.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

</body>

</html>